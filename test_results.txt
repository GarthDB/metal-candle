    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.26s
     Running unittests src/lib.rs (target/debug/deps/metal_candle-0ef016b15bdb6f27)

running 125 tests
test backend::device::tests::test_as_ref_trait ... ok
test backend::device::tests::test_device_clone ... ok
test backend::device::tests::test_as_candle_device ... ok
test backend::device::tests::test_cpu_device_creation ... ok
test backend::device::tests::test_device_conversions ... ok
test backend::device::tests::test_device_error_formatting ... ok
test backend::device::tests::test_device_debug ... ok
test backend::device::tests::test_device_type_debug ... ok
test backend::device::tests::test_device_type_equality ... ok
test backend::device::tests::test_into_candle_device ... ok
test backend::tensor::tests::test_layer_norm_with_different_eps ... ok
test backend::tensor::tests::test_rms_norm ... ok
test backend::tensor::tests::test_layer_norm ... ok
test backend::tensor::tests::test_softmax_preserves_shape ... ok
test backend::tensor::tests::test_softmax_stable ... ok
test backend::tensor::tests::test_softmax_stable_with_large_values ... ok
test error::tests::test_device_error_types ... ok
test error::tests::test_error_display ... ok
test error::tests::test_error_from_io ... ok
test error::tests::test_model_error_types ... ok
test error::tests::test_training_error_types ... ok
test backend::tensor::tests::test_tensor_ext_with_f16 ... ok
test inference::cache::tests::test_kv_cache_creation ... ok
test inference::cache::tests::test_kv_cache_clear ... ok
test inference::cache::tests::test_kv_cache_single_update ... ok
test inference::cache::tests::test_kv_cache_multiple_updates ... ok
test inference::cache::tests::test_kv_cache_full ... ok
test inference::generator::tests::test_generator_config_default ... ok
test inference::generator::tests::test_generator_creation ... ok
test inference::sampling::tests::test_greedy_sampling ... ok
test inference::sampling::tests::test_sampling_strategy_default ... ok
test inference::sampling::tests::test_top_k_sampling ... ok
test models::config::tests::test_config_defaults ... ok
test models::config::tests::test_config_from_json ... ok
test models::config::tests::test_config_validation_incompatible_dimensions ... ok
test models::config::tests::test_config_validation_kv_heads ... ok
test models::config::tests::test_config_validation_success ... ok
test models::config::tests::test_config_validation_zero_vocab ... ok
test models::config::tests::test_head_dim ... ok
test models::config::tests::test_num_kv_heads_default ... ok
test models::config::tests::test_num_kv_heads_specified ... ok
test models::loader::tests::test_inspect_nonexistent_file ... ok
test models::loader::tests::test_load_nonexistent_file ... ok
test models::loader::tests::test_loader_creation ... ok
test models::loader::tests::test_loader_device_accessor ... ok
test models::loader::tests::test_loader_with_dtype ... ok
test models::qwen::tests::test_qwen_decoder_layer_creation ... ok
test models::qwen::tests::test_qwen_model_creation ... ok
test models::qwen::tests::test_qwen_num_layers ... ok
test models::qwen::tests::test_qwen_num_parameters ... ok
test models::qwen::tests::test_rms_norm ... ok
test models::qwen::tests::test_rms_norm_forward ... ok
test models::transformer::tests::test_attention_creation ... ok
test models::transformer::tests::test_attention_forward ... ok
test models::qwen::tests::test_decoder_layer_forward ... ok
test models::transformer::tests::test_mlp_creation ... ok
test models::transformer::tests::test_mlp_different_sizes ... ok
test models::transformer::tests::test_attention_with_mask ... ok
test models::transformer::tests::test_mlp_forward ... ok
test models::transformer::tests::test_rotary_embedding_creation ... ok
test models::qwen::tests::test_qwen_forward ... ok
test tests::test_version_exists ... ok
test training::adapter::tests::test_lora_adapter_config_default ... ok
test models::transformer::tests::test_rotary_embedding_apply ... ok
test backend::device::tests::test_device_info ... ok
test backend::device::tests::test_metal_availability_detection ... ok
test backend::device::tests::test_device_info_debug ... ok
test backend::device::tests::test_metal_device_creation_on_macos ... ok
test backend::device::tests::test_cpu_device_info_fields ... ok
test backend::device::tests::test_metal_creation_behavior ... ok
test backend::device::tests::test_device_with_fallback ... ok
test backend::device::tests::test_metal_error_on_non_metal_platform ... ok
test backend::device::tests::test_from_candle_metal_device ... ok
test backend::device::tests::test_metal_availability_consistency ... ok
test training::adapter::tests::test_target_module_name ... ok
test training::adapter::tests::test_target_module_from_name ... ok
test backend::device::tests::test_device_with_fallback_on_metal_platform ... ok
test backend::device::tests::test_device_info_metal_path ... ok
test training::lora::tests::test_lora_config_scaling ... ok
test training::lora::tests::test_lora_config_validation ... ok
test training::lora::tests::test_lora_config_default ... ok
test training::lora::tests::test_lora_layer_invalid_rank ... ok
test training::lora::tests::test_lora_layer_gradients ... ok
test training::lora::tests::test_lora_layer_initialization ... ok
test training::loss::tests::test_cross_entropy_loss_basic ... ok
test training::lora::tests::test_lora_layer_trainable_variables ... ok
test training::loss::tests::test_cross_entropy_loss_invalid_shapes ... ok
test training::loss::tests::test_cross_entropy_loss_shape_mismatch ... ok
test training::loss::tests::test_cross_entropy_loss_wrong_prediction ... ok
test training::loss::tests::test_label_smoothing_effect ... ok
test training::adapter::tests::test_lora_adapter_creation ... ok
test training::loss::tests::test_cross_entropy_loss_with_ignore ... ok
test training::loss::tests::test_label_smoothing_invalid ... ok
test models::transformer::tests::test_rotary_embedding_different_seq_lengths ... ok
test training::checkpoint::tests::test_checkpoint_preserves_weights ... ok
test training::loss::tests::test_label_smoothing_zero ... ok
test training::optimizer::tests::test_adamw_config_default ... ok
test training::optimizer::tests::test_adamw_add_parameter ... ok
test training::checkpoint::tests::test_save_and_load_checkpoint ... ok
test training::optimizer::tests::test_adamw_config_validation ... ok
test training::optimizer::tests::test_adamw_parameter_not_found ... ok
test training::optimizer::tests::test_adamw_creation ... ok
test training::scheduler::tests::test_constant_scheduler ... ok
test training::optimizer::tests::test_adamw_step ... ok
test training::optimizer::tests::test_adamw_reset_state ... ok
test training::scheduler::tests::test_cosine_annealing ... ok
test training::optimizer::tests::test_adamw_multiple_steps ... ok
test training::scheduler::tests::test_linear_warmup ... ok
test training::scheduler::tests::test_scheduler_validation ... ok
test training::scheduler::tests::test_warmup_cosine ... ok
test training::trainer::tests::test_training_step_creation ... ok
test training::scheduler::tests::test_cosine_bounds ... ok
test training::scheduler::tests::test_warmup_cosine_monotonic_decay ... ok
test training::trainer::tests::test_training_step_reset ... ok
test training::trainer::tests::test_training_step_execute ... ok
test training::checkpoint::tests::test_save_checkpoint_without_metadata ... ok
test training::lora::tests::test_lora_layer_creation ... ok
test training::lora::tests::test_lora_layer_num_parameters ... ok
test training::lora::tests::test_lora_layer_forward ... ok
test training::adapter::tests::test_lora_adapter_forward ... ok
test training::adapter::tests::test_lora_adapter_get_layer ... ok
test training::lora::tests::test_lora_layer_different_dimensions ... ok
test training::adapter::tests::test_lora_adapter_merge_weights ... ok
test training::adapter::tests::test_lora_adapter_trainable_parameters ... ok
test models::qwen::tests::test_qwen_different_batch_sizes ... ok

test result: ok. 125 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.08s

     Running tests/gradient_verification.rs (target/debug/deps/gradient_verification-ec61c681afe5db71)

running 6 tests
test test_training_step_produces_valid_gradients ... ok
test test_zero_gradients_with_frozen_params ... ok
test test_optimizer_updates_parameters ... ok
test test_lora_adapter_gradient_collection ... ok
test test_lora_layer_gradient_flow ... ok
test test_gradient_accumulation_over_steps ... ok

test result: ok. 6 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.01s

     Running tests/inference_integration.rs (target/debug/deps/inference_integration-a1d0740e9c6ab5a9)

running 10 tests
test test_generator_config_defaults ... ok
test test_generator_creation ... ok
test test_sampling_consistency ... ok
test test_kv_cache_reset_and_reuse ... ok
test test_kv_cache_multi_layer_integration ... ok
test test_kv_cache_memory_efficiency ... ok
test test_sampling_with_edge_cases ... ok
test test_sampling_top_k_bounds ... ok
test test_sampling_strategies_valid_output ... ok
test test_kv_cache_concurrent_layers ... ok

test result: ok. 10 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests metal_candle

running 43 tests
test src/inference/cache.rs - inference::cache::KVCache::update (line 157) - compile ... ok
test src/models/config.rs - models::config::ModelConfig::from_file (line 87) - compile ... ok
test src/backend/tensor.rs - backend::tensor::TensorExt::softmax_stable (line 20) - compile ... ok
test src/backend/device.rs - backend::device::Device::new_metal (line 47) - compile ... ok
test src/lib.rs - (line 16) - compile ... ok
test src/models/config.rs - models::config::ModelConfig (line 17) - compile ... ok
test src/backend/tensor.rs - backend::tensor::TensorExt::layer_norm (line 46) - compile ... ok
test src/inference/mod.rs - inference (line 15) - compile ... ok
test src/models/loader.rs - models::loader::ModelLoader (line 19) - compile ... ok
test src/models/loader.rs - models::loader::ModelLoader::inspect (line 223) - compile ... ok
test src/models/loader.rs - models::loader::ModelLoader::load_with_validation (line 167) - compile ... ok
test src/models/loader.rs - models::loader::ModelLoader::load (line 83) - compile ... ok
test src/models/mod.rs - models (line 10) - compile ... ok
test src/models/transformer.rs - models::transformer::Attention (line 130) - compile ... ok
test src/models/qwen.rs - models::qwen::Qwen (line 108) - compile ... ok
test src/models/transformer.rs - models::transformer::MLP (line 329) - compile ... ok
test src/training/adapter.rs - training::adapter::LoRAAdapter (line 142) - compile ... ok
test src/models/transformer.rs - models::transformer::RotaryEmbedding (line 19) - compile ... ok
test src/training/checkpoint.rs - training::checkpoint::load_checkpoint (line 129) - compile ... ok
test src/training/checkpoint.rs - training::checkpoint::save_checkpoint (line 44) - compile ... ok
test src/training/lora.rs - training::lora::LoRALayer (line 135) - compile ... ok
test src/training/loss.rs - training::loss::cross_entropy_loss (line 38) - compile ... ok
test src/training/mod.rs - training (line 19) - compile ... ok
test src/training/optimizer.rs - training::optimizer::AdamW (line 151) - compile ... ok
test src/training/trainer.rs - training::trainer::Trainer (line 48) - compile ... ok
test src/training/trainer.rs - training::trainer::Trainer::train (line 132) - compile ... ok
test src/training/trainer.rs - training::trainer::TrainingStep (line 282) - compile ... ok
test src/training/trainer.rs - training::trainer::TrainingStep::execute (line 341) - compile ... ok
test src/backend/tensor.rs - backend::tensor::TensorExt::rms_norm (line 73) - compile ... ok
test src/training/lora.rs - training::lora::LoRAConfig (line 34) ... ok
test src/inference/cache.rs - inference::cache::KVCache (line 65) ... ok
test src/models/loader.rs - models::loader::ModelLoader::new (line 38) ... ok
test src/backend/device.rs - backend::device::Device::is_metal_available (line 185) ... ok
test src/backend/device.rs - backend::device::Device::new_cpu (line 73) ... ok
test src/training/optimizer.rs - training::optimizer::AdamWConfig (line 22) ... ok
test src/models/loader.rs - models::loader::ModelLoader::with_dtype (line 59) ... ok
test src/training/scheduler.rs - training::scheduler::LRScheduler (line 14) ... ok
test src/backend/device.rs - backend::device::Device::info (line 154) ... ok
test src/backend/device.rs - backend::device::Device::is_cpu (line 139) ... ok
test src/training/adapter.rs - training::adapter::LoRAAdapterConfig (line 70) ... ok
test src/models/config.rs - models::config::ModelConfig::from_json (line 117) ... ok
test src/backend/device.rs - backend::device::Device::is_metal (line 124) ... ok
test src/backend/device.rs - backend::device::Device::new_with_fallback (line 96) ... ok

test result: ok. 43 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 6.62s

